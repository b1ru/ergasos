<?php
	$con= mysqli_connect("localhost","root","","ergasos");
	if($con === false){
	die("ERROR: Could not connect. " . mysqli_connect_error());
	}
	
	mysqli_select_db($con, "ergasos");

?>


<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
	<title>Search-ErgaSOS</title>
	<link rel="stylesheet" type="text/css" href="./css/sstyle.css">
</head>
<body>



	<!-- NAVIGATION BAR -->
	<?php require("php/navbar.php"); ?>

	<div id="search">
		<form method="post"> 
			<label>Job Type</label>
					<select class="form" name="jobType">
						<option value="1">Full Time</option>>
						<option value="0">Part Time</option>>
					</select>
					<input type="text" name="name" placeholder="Search..">
					<input type="text" name="location" placeholder="Location..">
					<input type="submit" name="search-button" value="Search">
		</form>
	</div>	

	<?php
		if (!isset($_POST['name']) && !isset($_POST['location'])) {
			$sql = "SELECT * FROM listing_details";
			$r_query = mysqli_query($con,$sql); 
			$q_results= mysqli_num_rows($r_query);

			if ($q_results > 0) {
				while ($row = mysqli_fetch_assoc($r_query)){  
				?>
                 
                <div class="container">
					<section id="main">
						<a id="aggelia" href="#aggelia"> <?php echo $row['title']; ?> </a>
						<a id="etaireia" href="#etaireia"> <?php echo $row['creator']; ?> </a>
						<p id="location">
							<?php echo $row['city']; ?>
							<?php echo $row['country']; ?>
						</p>
					</section>
					<form action="./aggelia.html">
						<div>
							<input class="button" type="submit" value="Read More">
						</div>
					</form>
				</div>

	<?php
				}
			}
		}
		elseif (isset($_POST['name']) && isset($_POST['location'])) {
			$name = mysqli_real_escape_string($con, $_POST['name']);
			$location = mysqli_real_escape_string($con, $_POST['location']);
			$type = mysqli_real_escape_string($con, $_POST['jobType']);

			$sql = "SELECT title, creator, city, country, full_time FROM listing_details WHERE title LIKE  '%$name%' AND city LIKE  '%$location%' AND full_time=$type";
			$r_query = mysqli_query($con,$sql); 
			$q_results= mysqli_num_rows($r_query);

			if ($q_results > 0) {
			while ($row = mysqli_fetch_assoc($r_query)){  
				?>
                 
                <div class="container">
					<section id="main">
						<a id="aggelia" href="#aggelia"> <?php echo $row['title']; ?> </a>
						<a id="etaireia" href="#etaireia"> <?php echo $row['creator']; ?> </a>
						<p id="location">
							<?php echo $row['city']; ?>
							<?php echo $row['country']; ?>
						</p>
					</section>
					<form action="./aggelia.html">
						<div>
							<input class="button" type="submit" value="Read More">
						</div>
					</form>
				</div>

	<?php
			}
			}
		}

		elseif (isset($_POST['name']) && !isset($_POST['location'])) {
			$name = mysqli_real_escape_string($con, $_POST['name']);
			$location = mysqli_real_escape_string($con, $_POST['location']);
			$type = mysqli_real_escape_string($con, $_POST['jobType']);

			$sql = "SELECT title, creator, city, country, full_time FROM listing_details WHERE title LIKE  '%$name%' AND full_time=$type";
			$r_query = mysqli_query($con,$sql); 
			$q_results= mysqli_num_rows($r_query);

			if ($q_results > 0) {
			while ($row = mysqli_fetch_assoc($r_query)){  
				?>
                 
                <div class="container">
					<section id="main">
						<a id="aggelia" href="#aggelia"> <?php echo $row['title']; ?> </a>
						<a id="etaireia" href="#etaireia"> <?php echo $row['creator']; ?> </a>
						<p id="location">
							<?php echo $row['city']; ?>
							<?php echo $row['country']; ?>
						</p>
					</section>
					<form action="./aggelia.html">
						<div>
							<input class="button" type="submit" value="Read More">
						</div>
					</form>
				</div>

	<?php
			}
			}
		}
		elseif (!isset($_POST['name']) && isset($_POST['location'])) {
			$name = mysqli_real_escape_string($con, $_POST['name']);
			$location = mysqli_real_escape_string($con, $_POST['location']);
			$type = mysqli_real_escape_string($con, $_POST['jobType']);

			$sql = "SELECT title, creator, city, country, full_time FROM listing_details WHERE city LIKE '%$location%' AND full_time=$type";
			$r_query = mysqli_query($con,$sql); 
			$q_results= mysqli_num_rows($r_query);

			if ($q_results > 0) {
			while ($row = mysqli_fetch_assoc($r_query)){  
				?>
                 
                <div class="container">
					<section id="main">
						<a id="aggelia" href="#aggelia"> <?php echo $row['title']; ?> </a>
						<a id="etaireia" href="#etaireia"> <?php echo $row['creator']; ?> </a>
						<p id="location">
							<?php echo $row['city']; ?>
							<?php echo $row['country']; ?>
						</p>
					</section>
					<form action="./aggelia.html">
						<div>
							<input class="button" type="submit" value="Read More">
						</div>
					</form>
				</div>
		<?php
			}
			}
		}
	?>


	<!--<div class="container">
		<section id="main">
			<a id="aggelia" href="#aggelia">Junior Software Developer Intership(Thessaloniki)</a>
			<a id="etaireia" href="#etaireia">ΕργαSOS A.E.</a>
			<p id="location">
				Thessaloniki, Greece
			</p>
		</section>
		<form action="./aggelia.html">
			<div>
				<input class="button" type="submit" value="Read More">
			</div>
		</form>
	</div>

	<div class="container">
		<section id="main">
			<a id="aggelia" href="./aggelia.html">Junior Software Developer Intership(Thessaloniki)</a>
			<a id="etaireia" href="#etaireia">ΕργαSOS A.E.</a>
			<p id="location">
				Thessaloniki, Greece
			</p>
		</section>

		<form action="./aggelia.html">
			<div>
				<input class="button" type="submit" value="Read More">
			</div>
		</form>
	</div>

	<div class="container">
		<section id="main">
			<a id="aggelia" href="#aggelia">Junior Software Developer Intership(Thessaloniki)</a>
			<a id="etaireia" href="#etaireia">ΕργαSOS A.E.</a>
			<p id="location">
				Thessaloniki, Greece
			</p>
		</section>

		<form action="./aggelia.html">
			<div>
				<input class="button" type="submit" value="Read More">
			</div>
		</form>
	</div>
-->

			<!-- Footer -->
			<footer>
				<a class="footer-link" href="./contact.html">Contact Us</a>
			</footer>

</body>
</html>
